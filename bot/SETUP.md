# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - Telegram Bot

## –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 21

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
bot/
‚îú‚îÄ‚îÄ package.json                      ‚úì –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ .env.example                      ‚úì –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ .gitignore                        ‚úì –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ README.md                         ‚úì –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ DESIGN_PRINCIPLES.md              ‚úì –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îú‚îÄ‚îÄ SETUP.md                          ‚úì –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ bot.js                        ‚úì –°–æ–∑–¥–∞–Ω (–≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª)
    ‚îÇ
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îî‚îÄ‚îÄ index.js                  ‚úì –°–æ–∑–¥–∞–Ω (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –≤–∞–ª—é—Ç—ã)
    ‚îÇ
    ‚îú‚îÄ‚îÄ utils/
    ‚îÇ   ‚îú‚îÄ‚îÄ logger.js                 ‚úì –°–æ–∑–¥–∞–Ω (Winston logger)
    ‚îÇ   ‚îî‚îÄ‚îÄ api.js                    ‚úì –°–æ–∑–¥–∞–Ω (Backend API client)
    ‚îÇ
    ‚îú‚îÄ‚îÄ keyboards/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.js                   ‚úì –°–æ–∑–¥–∞–Ω (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)
    ‚îÇ   ‚îú‚îÄ‚îÄ seller.js                 ‚úì –°–æ–∑–¥–∞–Ω (–ø—Ä–æ–¥–∞–≤–µ—Ü + –≤–∞–ª—é—Ç—ã)
    ‚îÇ   ‚îú‚îÄ‚îÄ buyer.js                  ‚úì –°–æ–∑–¥–∞–Ω (–ø–æ–∫—É–ø–∞—Ç–µ–ª—å)
    ‚îÇ   ‚îî‚îÄ‚îÄ common.js                 ‚úì –°–æ–∑–¥–∞–Ω (–Ω–∞–∑–∞–¥, –æ—Ç–º–µ–Ω–∞)
    ‚îÇ
    ‚îú‚îÄ‚îÄ middleware/
    ‚îÇ   ‚îú‚îÄ‚îÄ auth.js                   ‚úì –°–æ–∑–¥–∞–Ω (–∞–≤—Ç–æ-–ª–æ–≥–∏–Ω)
    ‚îÇ   ‚îî‚îÄ‚îÄ error.js                  ‚úì –°–æ–∑–¥–∞–Ω (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏)
    ‚îÇ
    ‚îú‚îÄ‚îÄ handlers/
    ‚îÇ   ‚îú‚îÄ‚îÄ start.js                  ‚úì –°–æ–∑–¥–∞–Ω (/start)
    ‚îÇ   ‚îú‚îÄ‚îÄ seller/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js              ‚úì –°–æ–∑–¥–∞–Ω (seller handlers)
    ‚îÇ   ‚îú‚îÄ‚îÄ buyer/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js              ‚úì –°–æ–∑–¥–∞–Ω (buyer handlers)
    ‚îÇ   ‚îî‚îÄ‚îÄ common.js                 ‚úì –°–æ–∑–¥–∞–Ω (–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
    ‚îÇ
    ‚îî‚îÄ‚îÄ scenes/
        ‚îú‚îÄ‚îÄ createShop.js             ‚úì –°–æ–∑–¥–∞–Ω (FSM: 6 —à–∞–≥–æ–≤)
        ‚îú‚îÄ‚îÄ addProduct.js             ‚úì –°–æ–∑–¥–∞–Ω (FSM: 4 —à–∞–≥–∞)
        ‚îî‚îÄ‚îÄ searchShop.js             ‚úì –°–æ–∑–¥–∞–Ω (FSM: 2 —à–∞–≥–∞)
```

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ features:

### 1. FSM (Finite State Machine) Scenes:
- **createShop** - 6 —à–∞–≥–æ–≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞
  - –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã (BTC/ETH/USDT/LTC)
  - –ü–æ–∫–∞–∑ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã
  - –û–∂–∏–¥–∞–Ω–∏–µ TX hash
  - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
  - –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

- **addProduct** - 4 —à–∞–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  - –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
  - –í–≤–æ–¥ —Ü–µ–Ω—ã
  - –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

- **searchShop** - 2 —à–∞–≥–∞ –ø–æ–∏—Å–∫–∞
  - –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
  - –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### 2. –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω:
- –°–æ–æ–±—â–µ–Ω–∏—è: 2-3 —Å—Ç—Ä–æ–∫–∏
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã: 3-5 –∫–Ω–æ–ø–æ–∫
- Emoji —Ç–æ–ª—å–∫–æ –≤ –∫–Ω–æ–ø–∫–∞—Ö
- Edit –≤–º–µ—Å—Ç–æ send (smoother UX)
- –í—Å–µ–≥–¥–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"

### 3. Backend Integration:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (middleware)
- JWT —Ç–æ–∫–µ–Ω –≤ session
- API client —Å interceptors
- Graceful error handling

### 4. Logging:
- Winston logger (console + file)
- –¶–≤–µ—Ç–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
- `logs/combined.log` - –≤—Å–µ –ª–æ–≥–∏
- `logs/error.log` - —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏

### 5. –í–∞–ª—é—Ç—ã:
- Bitcoin (BTC) ‚Çø
- Ethereum (ETH) Œû
- USDT (ERC-20) ‚ÇÆ
- Litecoin (LTC) ≈Å

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd /Users/sile/Documents/Status\ Stock\ 4.0/bot
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env:
```bash
cp .env.example .env
nano .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç—å:
```env
BOT_TOKEN=your_bot_token_from_botfather
BACKEND_URL=http://localhost:3000
WEBAPP_URL=https://your-domain.com
NODE_ENV=development
LOG_LEVEL=info
```

### 3. –ü–æ–ª—É—á–∏—Ç—å BOT_TOKEN:
1. –û—Ç–∫—Ä—ã—Ç—å [@BotFather](https://t.me/BotFather)
2. `/newbot`
3. –£–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ username
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ `.env`

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Backend (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!):
```bash
cd ../backend
npm run dev
# Backend –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ http://localhost:3000
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:
```bash
# Development (—Å hot reload):
npm run dev

# Production:
npm start
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

### 1. –õ–æ–≥–∏:
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
```bash
tail -f logs/combined.log
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# Bot started successfully in development mode
# Backend URL: http://localhost:3000
# WebApp URL: https://your-domain.com
```

### 2. Telegram:
1. –û—Ç–∫—Ä–æ–π —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. `/start`
3. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   ```
   Telegram Shop

   –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:
   [üõç –ü–æ–∫—É–ø–∞—Ç–µ–ª—å]
   [üíº –ü—Ä–æ–¥–∞–≤–µ—Ü]
   ```

### 3. –ü—Ä–æ–≤–µ—Ä—å Backend:
```bash
curl http://localhost:3000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"ok"}
```

---

## User Flows —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:

### Seller Flow:
```
/start
  ‚Üí –ü—Ä–æ–¥–∞–≤–µ—Ü
    ‚Üí –°–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω
      ‚Üí –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã (BTC/ETH/USDT/LTC)
      ‚Üí –ê–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
      ‚Üí –í–≤–æ–¥ TX hash
      ‚Üí –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
      ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
      ‚Üí ‚úì –°–æ–∑–¥–∞–Ω

    ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
      ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ
      ‚Üí –¶–µ–Ω–∞
      ‚Üí –í–∞–ª—é—Ç–∞
      ‚Üí ‚úì –î–æ–±–∞–≤–ª–µ–Ω

    ‚Üí –ú–æ–∏ —Ç–æ–≤–∞—Ä—ã (WebApp)
    ‚Üí –ü—Ä–æ–¥–∞–∂–∏ (WebApp)
    ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (WebApp)
```

### Buyer Flow:
```
/start
  ‚Üí –ü–æ–∫—É–ø–∞—Ç–µ–ª—å
    ‚Üí –ù–∞–π—Ç–∏ –º–∞–≥–∞–∑–∏–Ω
      ‚Üí –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
      ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç
      ‚Üí –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è / –û—Ç–∫—Ä—ã—Ç—å (WebApp)

    ‚Üí –ü–æ–¥–ø–∏—Å–∫–∏
      ‚Üí –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤

    ‚Üí –ó–∞–∫–∞–∑—ã (WebApp)
    ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (WebApp)
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Backend API:**
   - –£–±–µ–¥–∏—Å—å —á—Ç–æ endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
     - `POST /api/auth/telegram`
     - `GET /api/shops/my`
     - `POST /api/shops`
     - `POST /api/products`
     - `POST /api/payments/address`
     - `POST /api/payments/verify`
     - –ò –¥—Ä—É–≥–∏–µ (—Å–º. README.md)

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å flows:**
   - [ ] /start —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] –†–æ–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è
   - [ ] createShop scene (6 —à–∞–≥–æ–≤)
   - [ ] addProduct scene (4 —à–∞–≥–∞)
   - [ ] searchShop scene (2 —à–∞–≥–∞)

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å WebApp URLs:**
   - –û–±–Ω–æ–≤–∏—Ç—å `WEBAPP_URL` –≤ `.env`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ WebApp –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏

4. **Production deployment:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å systemd service (—Å–º. README.md)
   - –ò–õ–ò Docker (—Å–º. README.md)
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏ rotation

---

## Troubleshooting:

### Bot –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å BOT_TOKEN
cat .env | grep BOT_TOKEN

# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
cat logs/error.log

# –ü—Ä–æ–≤–µ—Ä—å Node –≤–µ—Ä—Å–∏—é (–Ω—É–∂–Ω–∞ >=18)
node --version
```

### "BOT_TOKEN is not defined":
```bash
# –£–±–µ–¥–∏—Å—å —á—Ç–æ .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la .env

# –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç
cat .env
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: BOT_TOKEN=123456:ABC-DEF...
# –ë–ï–ó –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –∫–∞–≤—ã—á–µ–∫!
```

### "Failed to fetch" / API errors:
```bash
# –ü—Ä–æ–≤–µ—Ä—å Backend
curl http://localhost:3000/health

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –∑–∞–ø—É—Å—Ç–∏ Backend
cd ../backend
npm run dev
```

### Session errors:
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞
pkill -f "node src/bot.js"
npm run dev
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ó–∞–ø—É—Å–∫ —Å debug –ª–æ–≥–∞–º–∏
LOG_LEVEL=debug npm run dev

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/combined.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫
tail -f logs/error.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "node src/bot.js"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
pkill -f "node src/bot.js"
```

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- **README.md** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **DESIGN_PRINCIPLES.md** - UX/UI –≥–∞–π–¥–ª–∞–π–Ω—ã
- **src/bot.js** - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–Ω–∞—á–Ω–∏ –æ—Ç—Å—é–¥–∞)
- **src/scenes/** - FSM –ª–æ–≥–∏–∫–∞ (multi-step flows)
- **src/handlers/** - Event handlers
- **src/keyboards/** - Inline keyboards

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã:

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `tail -f logs/error.log`
2. –ü—Ä–æ—á–∏—Ç–∞–π README.md
3. –ü—Ä–æ—á–∏—Ç–∞–π DESIGN_PRINCIPLES.md
4. –ü—Ä–æ–≤–µ—Ä—å Backend API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

---

**–°—Ç–∞—Ç—É—Å:** ‚úì –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
