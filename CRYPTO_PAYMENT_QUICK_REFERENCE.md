# CRYPTO PAYMENT AUTOMATION - QUICK REFERENCE

**Status**: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ | **–î–∞—Ç–∞**: –û–∫—Ç—è–±—Ä—å 2025

---

## TOP 3 –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. NOWPayments ‚≠ê‚≠ê‚≠ê (–í–´–ë–ò–†–ê–ï–ú –°–ï–ô–ß–ê–°)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: 0.5% –Ω–∞ –ø–ª–∞—Ç–µ–∂
- **Setup**: 2-3 –¥–Ω—è
- **–ü–ª—é—Å—ã**: –ü—Ä–æ—Å—Ç–æ–π API, –≤—Å–µ –≤–∞–ª—é—Ç—ã, real-time webhook
- **–ú–∏–Ω—É—Å—ã**: –ö–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Ç–µ—Ç —Å volume
- **–ü–æ–¥—Ö–æ–¥–∏—Ç**: MVP –¥–æ 10k –ø–ª–∞—Ç–µ–∂–µ–π/–º–µ—Å

### 2. Tatum ‚≠ê‚≠ê‚≠ê (–í–´–ë–ò–†–ê–ï–ú –ö–û–ì–î–ê –†–ê–°–¢–ï–¢)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: $99-999/–º–µ—Å (–ø–æ volume)
- **Setup**: 3-5 –¥–Ω–µ–π
- **–ü–ª—é—Å—ã**: 50+ –±–ª–æ–∫—á–µ–π–Ω–æ–≤, enterprise-grade, real-time webhook
- **–ú–∏–Ω—É—Å—ã**: –î–æ—Ä–æ–∂–µ –Ω–∞ –º–∞–ª—ã—Ö –æ–±—ä–µ–º–∞—Ö
- **–ü–æ–¥—Ö–æ–¥–∏—Ç**: Production –ø—Ä–∏ >1k –ø–ª–∞—Ç–µ–∂–µ–π/–º–µ—Å

### 3. Self-hosted Polling ‚≠ê‚≠ê‚≠ê (–ö–ê–ö FALLBACK)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: FREE
- **Setup**: 2 –¥–Ω—è
- **–ü–ª—é—Å—ã**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –≤—Å–µ –≤–∞–ª—é—Ç—ã
- **–ú–∏–Ω—É—Å—ã**: 30 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞, –Ω—É–∂–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ü–æ–¥—Ö–æ–¥–∏—Ç**: –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª + backup

---

## –¢–ê–ë–õ–ò–¶–ê –°–†–ê–í–ù–ï–ù–ò–Ø (15 –°–ï–†–í–ò–°–û–í)

| # | –°–µ—Ä–≤–∏—Å | BTC | ETH | USDT | Webhook | Cost | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í–´–í–û–î |
|---|--------|-----|-----|------|---------|------|-----------|-------|
| 1 | **NOWPayments** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | 0.5% | 2/10 | üèÜ MVP |
| 2 | **Tatum** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | $99 | 4/10 | üèÜ PROD |
| 3 | Alchemy | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | $400 | 3/10 | ‚ö†Ô∏è –¥–æ—Ä–æ–≥–æ |
| 4 | BTCPay | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ | FREE | 7/10 | ‚ö†Ô∏è —Å–ª–æ–∂–Ω–æ |
| 5 | Coinbase | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | 1% | 2/10 | ‚ö†Ô∏è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ |
| 6 | Mempool | ‚úÖ | ‚ùå | ‚ùå | ‚ö†Ô∏è | FREE | 5/10 | ‚úÖ BTC only |
| 7 | Etherscan | ‚ùå | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | FREE | 3/10 | ‚úÖ ETH only |
| 8 | Infura | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | VAR | 4/10 | ‚úÖ EVM |
| 9 | Self-hosted | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | FREE | 5/10 | ‚úÖ fallback |

---

## –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (HYBRID)

```
PRIMARY: NOWPayments webhook
  ‚Üì
SECONDARY: Self-hosted polling (30 —Å–µ–∫) - –µ—Å–ª–∏ webhook –Ω–µ –¥–æ—à–µ–ª
  ‚Üì
FALLBACK: Direct blockchain API (Etherscan/blockchain.info)
```

### –§–∞–∑—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: MVP (—Å–µ–π—á–∞—Å, 1-2 –Ω–µ–¥–µ–ª–∏)**
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å NOWPayments
- Webhook + polling
- ‚úÖ Deploy

**–§–∞–∑–∞ 2: Prod (6 –º–µ—Å—è—Ü–µ–≤)**
- –î–æ–±–∞–≤–∏—Ç—å Tatum –∫–∞–∫ primary
- NOWPayments –∫–∞–∫ secondary
- Multi-provider redundancy

**–§–∞–∑–∞ 3: Scale (12 –º–µ—Å—è—Ü–µ–≤)**
- Migrate –Ω–∞ Tatum –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –£–±—Ä–∞—Ç—å NOWPayments –∫–æ–º–∏—Å—Å–∏—è
- Enterprise infrastructure

---

## –°–¢–û–ò–ú–û–°–¢–¨ –ü–û –°–¶–ï–ù–ê–†–ò–Ø–ú

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: Small (100 –ø–ª–∞—Ç–µ–∂–µ–π/–º–µ—Å)
```
NOWPayments: 100 √ó $25 √ó 0.5% = $12.5/–º–µ—Å
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: $0 (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö —Å–µ—Ä–≤–µ—Ä)
–ò–¢–û–ì–û: $12.5/–º–µ—Å
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Medium (10k –ø–ª–∞—Ç–µ–∂–µ–π/–º–µ—Å)
```
NOWPayments: 10000 √ó $25 √ó 0.5% = $1,250/–º–µ—Å ‚ö†Ô∏è –¥–æ—Ä–æ–≥–æ
–ò–ª–∏ Tatum: $99-299/–º–µ—Å ‚úÖ –¥–µ—à–µ–≤–ª–µ
–í–´–ë–ò–†–ê–ï–ú: Tatum
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Large (100k –ø–ª–∞—Ç–µ–∂–µ–π/–º–µ—Å)
```
Tatum Business: $999/–º–µ—Å
–ü–ª—é—Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: $50-100/–º–µ—Å
–ò–¢–û–ì–û: $1,050/–º–µ—Å
```

---

## –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### NOWPayments Integration

```javascript
// 1. –ù–æ–≤—ã–π —Ñ–∞–π–ª: backend/src/services/nowpaymentsService.js
‚úÖ createInvoice()
‚úÖ verifyWebhookSignature()
‚úÖ processWebhook()
‚úÖ getInvoiceStatus()

// 2. –û–±–Ω–æ–≤–∏—Ç—å: backend/src/controllers/paymentController.js
‚úÖ createNOWPaymentsInvoice()
‚úÖ nowpaymentsWebhook()
‚úÖ checkInvoiceStatus()

// 3. –û–±–Ω–æ–≤–∏—Ç—å: backend/src/routes/payments.js
‚úÖ POST /api/payments/nowpayments/create
‚úÖ POST /api/payments/webhooks/nowpayments
‚úÖ GET /api/payments/invoice/status

// 4. Database
‚úÖ ALTER TABLE payments ADD invoice_id, provider, webhook_timestamp
‚úÖ CREATE INDEX idx_payments_invoice_id

// 5. Environment
‚úÖ NOWPAYMENTS_API_KEY
‚úÖ NOWPAYMENTS_IPN_SECRET
‚úÖ NOWPAYMENTS_WEBHOOK_URL
```

### Self-hosted Polling (Backup)

```javascript
// 1. –ù–æ–≤—ã–π —Ñ–∞–π–ª: backend/src/services/paymentMonitorService.js
‚úÖ start() - –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–π worker
‚úÖ monitorPendingPayments() - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
‚úÖ checkPayment() - –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø–ª–∞—Ç–µ–∂
‚úÖ stop() - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å worker

// 2. –û–±–Ω–æ–≤–∏—Ç—å: backend/src/server.js
‚úÖ paymentMonitor.start() –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
‚úÖ paymentMonitor.stop() –ø—Ä–∏ shutdown

// 3. Database
‚úÖ –£–∂–µ –µ—Å—Ç—å –≤ —Ç–µ–∫—É—â–µ–π schema (payments table)
```

---

## MIGRATION ROADMAP

### Week 1: Development
- [ ] –°–æ–∑–¥–∞—Ç—å nowpaymentsService.js
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ testnet
- [ ] Code review

### Week 2: Staging
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ staging
- [ ] E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Load —Ç–µ—Å—Ç—ã

### Week 3: Production
- [ ] Blue-green deployment
- [ ] Monitor –ª–æ–≥–∏
- [ ] A/B test (50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### Week 4: Rollout
- [ ] 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –£–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ (–µ—Å–ª–∏ –≤—Å–µ OK)

---

## –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ & –†–ï–®–ï–ù–ò–Ø

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| Webhook –Ω–µ –¥–æ—à–µ–ª | NOWPayments down | Self-hosted polling fallback |
| –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è | API lag | –£–≤–µ–ª–∏—á–∏—Ç—å polling frequency |
| –í—ã—Å–æ–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è | –ú–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π | Migrate –Ω–∞ Tatum |
| TX Hash –≤ mempool | –ó–∞–≤–∏—Å–∞–µ—Ç | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞, –∂–¥–∞—Ç—å |
| User —Å–ø–µ—à–∏—Ç | –ù–µ—Ç instant –ø–ª–∞—Ç–µ–∂–µ–π | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ —Å—É–º–º—ã |

---

## –ö–û–ì–î–ê –ú–ï–ù–Ø–¢–¨ –ü–†–û–í–ê–ô–î–ï–†–ê

### Switch –Ω–∞ Tatum –∫–æ–≥–¥–∞:
- –ü–ª–∞—Ç–µ–∂–∏: >1,000/–º–µ—Å
- –ö–æ–º–∏—Å—Å–∏—è NOWPayments: >$500/–º–µ—Å
- –ù—É–∂–Ω–∞: Multi-provider redundancy
- –¢—Ä–µ–±—É–µ—Ç—Å—è: Enterprise SLA

### Keep NOWPayments –µ—Å–ª–∏:
- –ü–ª–∞—Ç–µ–∂–∏: <1,000/–º–µ—Å
- –ö–æ–º–∏—Å—Å–∏—è: <$500/–º–µ—Å
- –ü—Ä–æ—Å—Ç–æ—Ç–∞: –∫—Ä–∏—Ç–∏—á–Ω–∞
- –ë—é–¥–∂–µ—Ç: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω

---

## API –ü–†–ò–ú–ï–†–´

### NOWPayments: Create Invoice
```bash
curl -X POST https://api.nowpayments.io/v1/invoice \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "price_amount": 25.00,
    "price_currency": "USD",
    "pay_currency": "btc",
    "order_id": "123",
    "ipn_callback_url": "https://your-api.com/webhooks/nowpayments"
  }'
```

### Response
```json
{
  "id": "inv_123abc",
  "pay_address": "1A1z7agoat...",
  "pay_amount": 0.00045,
  "pay_currency": "btc",
  "expiration_date": "2025-10-25T14:30:00Z"
}
```

### Webhook (–æ—Ç NOWPayments ‚Üí –≤–∞—à endpoint)
```json
POST /api/payments/webhooks/nowpayments
{
  "invoice_id": "inv_123abc",
  "payment_status": "finished",
  "pay_amount": 0.00045,
  "pay_currency": "btc",
  "order_id": "123",
  "confirmations": 3,
  "received_amount": 0.00045
}
```

---

## –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø & –°–°–´–õ–ö–ò

- NOWPayments API: https://documenter.getpostman.com/view/7907941/SVfwTyxo
- Tatum API: https://tatum.io/docs
- BTCPay Docs: https://docs.btcpayserver.org
- Etherscan API: https://docs.etherscan.io
- Mempool API: https://mempool.space/api
- Coinbase Commerce: https://commerce.coinbase.com/docs

---

## –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢

### ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú: NOWPayments (MVP)
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –í—Å–µ –≤–∞–ª—é—Ç—ã
- Real-time webhooks
- 0.5% –∫–æ–º–∏—Å—Å–∏—è OK –¥–ª—è –º–∞–ª—ã—Ö –æ–±—ä–µ–º–æ–≤

### ‚è∞ –í –ë–£–î–£–©–ï–ú: Tatum (Scale)
- Enterprise-grade
- Multi-provider
- –õ—É—á—à–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö volume'–∞—Ö

### üîÑ –í–°–ï–ì–î–ê: Self-hosted polling (Fallback)
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–∑–µ—Ä–≤
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

---

**–ê–≤—Ç–æ—Ä**: Claude Code  
**–î–∞—Ç–∞**: –û–∫—Ç—è–±—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å**: Ready to implement
